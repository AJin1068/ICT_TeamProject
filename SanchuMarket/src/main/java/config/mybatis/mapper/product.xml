<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="product">
	
	<resultMap type="vo.product.ProductVo" id="product_map">
		<result property="p_idx" column="p_idx"/>
		
		<collection property="image_list" 
					column="{p_idx=p_idx}"
					select="image_list_p_idx"/>
	
	</resultMap>
	<!--  -->

	<!-- 내 판매물품 조회 -->
	<select id="product_user_idx" resultType="vo.product.ProductVo">
		select * from product where u_idx=#{u_idx} 
	</select>

	<!-- 회원목록 조회  -->
	<select id="product_list"  resultMap="product_map" >
		select
			p.* ,
			to_number(floor((sysdate-p_date)*24*60*60)) as p_time
		from (select * from product) p order by p_idx desc
	</select>
	
	<select id="image_list_p_idx" resultType="vo.image.ImageVo">
		select * from image where p_idx=#{p_idx}
	</select>
	
	
	
	

	<insert id="product_insert" parameterType="vo.product.ProductVo">
		insert into product values(
		(select nvl(max(p_idx)+1,1) from product),
		 #{u_idx},
		 #{c_idx},
		 #{p_name},
		 sysdate,
		 #{p_price},
		 #{p_condition},
		 #{p_exp},
		 #{p_location},
		 0,
		 #{p_status})
	</insert>
		
	

</mapper>












